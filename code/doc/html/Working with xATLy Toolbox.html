<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,IE=9,chrome=1"><meta name="generator" content="MATLAB 2022b"><title>Untitled</title><style type="text/css">.rtcContent { padding: 30px; } .S0 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 20px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 20px; font-weight: 700; text-align: left;  }
.S1 { margin: 2px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S2 { margin: 10px 0px 20px; padding-left: 0px; font-family: Helvetica, Arial, sans-serif; font-size: 14px;  }
.S3 { margin-left: 56px; line-height: 21px; min-height: 0px; text-align: left; white-space: pre-wrap;  }
.S4 { margin: 15px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }
.CodeBlock { background-color: #F5F5F5; margin: 10px 0 10px 0; }
.S5 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 1px solid rgb(191, 191, 191); border-bottom: 0px none rgb(33, 33, 33); border-radius: 4px 4px 0px 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S6 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 0px none rgb(33, 33, 33); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 0px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S7 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(191, 191, 191); border-radius: 0px 0px 4px 4px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S8 { margin: 10px 10px 9px 4px; padding: 0px; line-height: 21px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 14px; font-weight: 400; text-align: left;  }
.S9 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 0px none rgb(33, 33, 33); border-bottom: 1px solid rgb(191, 191, 191); border-radius: 0px; padding: 0px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S10 { color: rgb(33, 33, 33); padding: 10px 0px 6px 17px; background: rgb(255, 255, 255) none repeat scroll 0% 0% / auto padding-box border-box; font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px; overflow-x: hidden; line-height: 17.234px;  }
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsErrorElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsErrorElement .diagnosticMessage-errorType {    overflow: auto;}
.embeddedOutputsErrorElement.inlineElement {}
.embeddedOutputsErrorElement.rightPaneElement {}
/* Styling that is common to warnings and errors is in diagnosticOutput.css */.embeddedOutputsWarningElement {    min-height: 18px;    max-height: 550px;}
.embeddedOutputsWarningElement .diagnosticMessage-warningType {    overflow: auto;}
.embeddedOutputsWarningElement.inlineElement {}
.embeddedOutputsWarningElement.rightPaneElement {}
/* Copyright 2015-2019 The MathWorks, Inc. *//* In this file, styles are not scoped to rtcContainer since they could be in the Dojo Tooltip */.diagnosticMessage-wrapper {    font-family: Menlo, Monaco, Consolas, "Courier New", monospace;    font-size: 12px;}
.diagnosticMessage-wrapper.diagnosticMessage-warningType {    color: rgb(255,100,0);}
.diagnosticMessage-wrapper.diagnosticMessage-warningType a {    color: rgb(255,100,0);    text-decoration: underline;}
.diagnosticMessage-wrapper.diagnosticMessage-errorType {    color: rgb(230,0,0);}
.diagnosticMessage-wrapper.diagnosticMessage-errorType a {    color: rgb(230,0,0);    text-decoration: underline;}
.diagnosticMessage-wrapper .diagnosticMessage-messagePart,.diagnosticMessage-wrapper .diagnosticMessage-causePart {    white-space: pre-wrap;}
.diagnosticMessage-wrapper .diagnosticMessage-stackPart {    white-space: pre;}
.embeddedOutputsTextElement,.embeddedOutputsVariableStringElement {    white-space: pre;    word-wrap:  initial;    min-height: 18px;    max-height: 550px;}
.embeddedOutputsTextElement .textElement,.embeddedOutputsVariableStringElement .textElement {    overflow: auto;}
.textElement,.rtcDataTipElement .textElement {    padding-top: 2px;}
.embeddedOutputsTextElement.inlineElement,.embeddedOutputsVariableStringElement.inlineElement {}
.inlineElement .textElement {}
.embeddedOutputsTextElement.rightPaneElement,.embeddedOutputsVariableStringElement.rightPaneElement {    min-height: 16px;}
.rightPaneElement .textElement {    padding-top: 2px;    padding-left: 9px;}
.S11 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 1px solid rgb(191, 191, 191); border-bottom: 1px solid rgb(191, 191, 191); border-radius: 4px 4px 0px 0px; padding: 6px 45px 4px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S12 { border-left: 1px solid rgb(191, 191, 191); border-right: 1px solid rgb(191, 191, 191); border-top: 1px solid rgb(191, 191, 191); border-bottom: 0px none rgb(33, 33, 33); border-radius: 0px; padding: 6px 45px 0px 13px; line-height: 18.004px; min-height: 0px; white-space: nowrap; color: rgb(33, 33, 33); font-family: Menlo, Monaco, Consolas, "Courier New", monospace; font-size: 14px;  }
.S13 { margin: 3px 10px 5px 4px; padding: 0px; line-height: 18px; min-height: 0px; white-space: pre-wrap; color: rgb(33, 33, 33); font-family: Helvetica, Arial, sans-serif; font-style: normal; font-size: 17px; font-weight: 700; text-align: left;  }</style></head><body><div class = rtcContent><h2  class = 'S0' id = 'H_488EC39C' ><span>Introduction to working with the xATLy toolbox</span></h2><div  class = 'S1'><span>The xATLy toolkit comprises of various functions and classes that are designed to seamlessly integrate with the MATLABÂ® environments provided by MathWorks. Its main purpose is to simplify the reading, visualization, and manipulation of ICESat-2 ATL03 and ATL08 data in HDF5 format. Ultimately, the goal of the toolkit is to enable the creation of custom terrain and canopy height datasets that align with specific user requirements.</span></div><div  class = 'S1'><span>The xATLy toolkit was created to establish a connection between ATL03 and ATL08 data, with the aim of deriving precise vegetation height estimates. To achieve this, the toolkit has implemented an object-oriented design that consists of three main class objects: Atl03, Atl08, and gtrack.</span></div><ul  class = 'S2'><li  class = 'S3'><span>The Atl03 class is responsible for providing an interface to access the photon level 3D data stored in HDF5 files, making it easier for users to access this information. The Atl08 class, on the other hand, offers access to a diverse range of ATL08 segment level attributes, such as canopy and terrain height metrics and signal photon level classifications, which can be used to generate highly detailed datasets.</span></li><li  class = 'S3'><span>Finally, the gtrack class is a ground track object that represents one of the six ground tracks present in an ATL03/ATL08 granule. This class plays a crucial role in the process of deriving vegetation height estimates, as it enables users to identify and analyze specific ground tracks that are relevant to their research.</span></li></ul><div  class = 'S1'><span>To establish a clear relationship between the gtrack object and matching ATL03 and ATL08 granule objects, the former has been modeled as a OOP composition. This approach ensures that the gtrack object is tightly bound to its corresponding granule objects, allowing for efficient data manipulation.</span></div><div  class = 'S1'><span>The methods associated with the gtrack object typically produce tabular data formats that include raw, classified, and normalized ATL03 points. In addition to these outputs, the gtrack object also provides auxiliary data such as ATL08 segment polygons in shapefile or KML format. This makes it easier for users to visualize and analyze the data, as it can be easily integrated into other tools and software.</span></div><div  class = 'S1'><span>The following sections demonstrates features of the xATLy toolbox including:</span></div><ol  class = 'S2'><li  class = 'S3'><a href = "#H_5C26FFC9"><span>Defining Atl03 and Atl08 objects</span></a></li><li  class = 'S3'><a href = "#H_D3FBAA77"><span>Defining ground track object for data access</span></a></li><li  class = 'S3'><a href = "#H_79D269AE"><span>Exploring and reading data and attributes from defined ground track</span></a></li><li  class = 'S3'><a href = "#H_32BFFF48"><span>Displaying raw and classified ATL03 point clouds for a ground track</span></a></li><li  class = 'S3'><a href = "#H_7FE258F4"><span>Generating auxiliary Reference ground track (RGT) and ATL08 segment vector data</span></a></li><li  class = 'S3'><a href = "#H_1AEFA7CC"><span>Saving retrieved point cloud data</span></a></li><li  class = 'S3'><a href = "#H_E967A39A"><span>Concluding remarks</span></a></li></ol><h3  class = 'S4' id = 'H_5C26FFC9' ><span>Define Atl03 and Atl08 objects</span></h3><div  class = 'S1'><span>Access to ATL03 and ATL08 data is established through respective </span><span style=' font-family: monospace;'>Atl03</span><span> and </span><span style=' font-family: monospace;'>Atl08</span><span> objects as illustrated below. Two file paths are provided, one for the ATL03 and other for the matching ATL08 data.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >atl03path = </span><span style="color: rgb(167, 9, 245);">'F:\devs\xATLy\data\ATL03_20190603025340_10050314_002_01.h5'</span><span >; </span><span style="color: rgb(0, 128, 19);">% ATL03 filepath</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >atl08path = </span><span style="color: rgb(167, 9, 245);">'F:\devs\xATLy\data\ATL08_20190603025340_10050314_002_01.h5'</span><span >; </span><span style="color: rgb(0, 128, 19);">% ATL08 filepath</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% creates Atl03 and Atl08 objects</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >a3 = Atl03(atl03path);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >a8 = Atl08(atl08path);</span></span></div></div></div><div  class = 'S8'><span>Display basic object properties using MATLAB disp function. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% ATL03 - basic attributes</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S9'><span style="white-space: pre"><span >disp(a3) </span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="B8EE3559" prevent-scroll="true" data-testid="output_0" style="width: 1146px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-width="1116" data-height="135" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">  Atl03 with properties:

        filepath: 'F:\devs\xATLy\data\ATL03_20190603025340_10050314_002_01.h5'
     producttype: 'ATL03'
        orbitnum: 3980
        cyclenum: 3
       sc_orient: 0
    groundtracks: {'gt1l'  'gt1r'  'gt2l'  'gt2r'  'gt3l'  'gt3r'}
    beamsequence: {'Strong'  'Weak'  'Strong'  'Weak'  'Strong'  'Weak'}</div></div></div></div></div><div  class = 'S8'><span>For a slightly detailed display of granule properties one can use the </span><span style=' font-family: monospace;'>showinfo</span><span> method for both the </span><span style=' font-family: monospace;'>Atl03</span><span> and </span><span style=' font-family: monospace;'>Atl08</span><span> objects. The ATL03/ and ATL08 products have numerous attributes. The </span><span style=' font-family: monospace;'>showinfo</span><span> method only outputs a few attributes necessary to provide an adequate overview of dataset as shown below.</span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S11'><span style="white-space: pre"><span >a3.showinfo() </span><span style="color: rgb(0, 128, 19);">% detailed attributes/values</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="8F2F056A" prevent-scroll="true" data-testid="output_1" style="width: 1146px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-width="1116" data-height="223" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"> &lt;--------------------------- Dataset Info -------------------------&gt;
                                                         
   Granule ID: ATL03_20190603025340_10050314_002_01.h5
   Version ID: 002
   Orbit/Cycle number: 3980/3
   Spacecraft orientation: 0 [Backward] 
                                                         
   Track IDs: | gt1l | gt1r | gt2l | gt2r | gt3l | gt3r | 
   Beam sequence: | Strong | Weak | Strong | Weak | Strong | Weak | 
   Number points: | 77918 | 18455 | 57574 | 20583 | 85455 | 19403 | 
                                                         
   Min/Max Lat/Lon: [-13.7157 23.8022] [-13.7155 23.8626]
   Approx. Range(km): 3.25
                                                         
 &lt;--------------------------- End of Info -------------------------&gt;</div></div></div></div><div class="inlineWrapper"><div  class = 'S12'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% ATL08</span></span></div></div><div class="inlineWrapper outputs"><div  class = 'S9'><span style="white-space: pre"><span >disp(a8)</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="80A90485" prevent-scroll="true" data-testid="output_2" style="width: 1146px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-width="1116" data-height="135" data-hashorizontaloverflow="false" style="max-height: 261px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;">  Atl08 with properties:

        filepath: 'F:\devs\xATLy\data\ATL08_20190603025340_10050314_002_01.h5'
     producttype: 'ATL08'
        orbitnum: 3980
        cyclenum: 3
       sc_orient: 0
    groundtracks: {'gt1l'  'gt1r'  'gt2l'  'gt2r'  'gt3l'  'gt3r'}
    beamsequence: {'Strong'  'Weak'  'Strong'  'Weak'  'Strong'  'Weak'}</div></div></div></div></div><div  class = 'S8'><span></span></div><div  class = 'S1'><span></span></div><div  class = 'S1'><span></span></div><div class="CodeBlock"><div class="inlineWrapper outputs"><div  class = 'S11'><span style="white-space: pre"><span >a8.showinfo()</span></span></div><div  class = 'S10'><div class="inlineElement eoOutputWrapper embeddedOutputsTextElement" uid="0C7CB24A" prevent-scroll="true" data-testid="output_3" style="width: 1146px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"><div class="textElement eoOutputContent" data-width="1116" data-height="297" data-hashorizontaloverflow="false" style="max-height: 308px; white-space: pre; font-style: normal; color: rgb(33, 33, 33); font-size: 12px;"> &lt;--------------------------- Dataset Info -------------------------&gt;
                                                         
   Granule ID: ATL08_20190603025340_10050314_002_01.h5
   Version ID: 002
   Orbit/Cycle number: 3980/3
   Spacecraft orientation: 0 [Backward] 
                                                         
   Track IDs: | gt1l | gt1r | gt2l | gt2r | gt3l | gt3r | 
   Beam sequence: | Strong | Weak | Strong | Weak | Strong | Weak | 
   No. segments: | 986 | 449 | 985 | 304 | 986 | 320 | 
   No. canopy pts: | 41884 | 4201 | 41601 | 4741 | 47070 | 3705 | 
   No. top.canopy pts: | 13108 | 646 | 13349 | 879 | 15155 | 581 | 
   No. terrain pts: | 153367 | 22768 | 94378 | 14249 | 140335 | 16016 | 
                                                         
   Min/max Lat/Lon: [-13.9793, 23.8290] [-13.9768, 23.8893]
   Approx. distance: 3.51 km
   Min/max canopy height (m): [0.5, 38.2]
   Min/max terrain height (m): [1031.9, 1155.8]
                                                         
 &lt;--------------------------- End of Info -------------------------&gt;</div></div></div></div></div><div  class = 'S8'><span>It is important to note that the orbit number (orbitnum) and cycle number (cyclenum) must match between the two objects in order to ensure that both datasets represent identical ground tracks. This is a critical requirement that must be met to avoid any discrepancies in the data.</span></div><div  class = 'S1'><span>As a result of this matching process, the ground tracks (groundtracks) and beam sequence (beamsequence) will also be identical. However, there are instances where some tracks may not be processed in the ATL08 product due to data corruption, resulting in a lack of corresponding ATL08 tracks for some ATL03 tracks.</span></div><div  class = 'S1'><span>The spacecraft is responsible for determining the sequence of strong and weak beams, with strong beams leading weak beams in each pair. In this particular case, the spacecraft orientation is backward (sc_orient = 0).</span></div><h3  class = 'S13' id = 'H_D3FBAA77' ><span>Define a gtrack object</span></h3><div  class = 'S1'><span>In the xATLy toolbox, calculations are performed at ground track level. As noted already, a gtrack object has a relationship to matching Atl03 and Atl08 objects to build synergy between the two products for vegetation applications. The code below initializes a gtrack object for the 'gt1l' track, which is a strong beam as shown by the beamlevel attribute below. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >gt = gtrack(</span><span style="color: rgb(167, 9, 245);">'gt1l'</span><span >,a3,a8);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >disp(gt)</span></span></div></div></div><div  class = 'S8'><span>From the output, you can see that this ground track object has atl03 and atl08 properties, which establishes the relationship. With the arrangement, one can access ATL03 related attributes through the atl03 object. Likewise, one can access ATL08 attributes through the atl08 object. This facility is demonstrated in the next section.</span></div><h3  class = 'S13' id = 'H_79D269AE' ><span>Accessing ground track photon or segment level data</span></h3><div  class = 'S1'><span style=' font-style: italic;'>Reading raw point cloud data.</span><span> After creating a ground track object, it is possible to read raw ATL03 point cloud data by utilizing the getrawpc method, as demonstrated below. This method returns a table object that contains geolocation, elevation, and signal confidence attributes. Additionally, the table includes estimated along-track distances, which can be used for plotting and distance-based analyses. The along-track distance is calculated by scaling delta times values by a factor of 1 second equals 7000 meters. The table also includes a signal confidence attribute related to land/vegetation surfaces. Please refer to the </span><a href = "https://nsidc.org/sites/default/files/icesat2_atl03_atbd_r005_0.pdf"><span>ATL03 ATBD</span></a><span> for definitions for the other attributes in the table. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >format(</span><span style="color: rgb(167, 9, 245);">'bank'</span><span >) </span><span style="color: rgb(0, 128, 19);">% for presentation purposes only - values formatted with 2 decimal places</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >rpc = gt.getrawpc(); </span><span style="color: rgb(0, 128, 19);">% gets the raw point cloud</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% display table columns</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >disp(string(rpc.Properties.VariableNames)')</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% disp first five rows and first seven columns of the data - signal_conf</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% not dispalyed due to page limitations. You may display the whole table</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% using disp(rpc(1:5,:)) </span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >disp(rpc(1:5,1:7)) </span></span></div></div><div class="inlineWrapper"><div  class = 'S7'>&nbsp;</div></div></div><div  class = 'S1'><span style=' font-style: italic;'>Retrieving classified ATL03 point clouds. </span><span>The xATLy toolbox facilitates linking of ATL08 signal photon classifications, under the signal_photons group, with raw ATL03 point clouds to derive a classified point cloud through the </span><span style=' font-family: monospace;'>getclassedpc</span><span> method. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >cpc = gt.getclassedpc(); </span><span style="color: rgb(0, 128, 19);">% get classed point cloud</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% display table columns</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >disp(string(cpc.Properties.VariableNames)')</span></span></div></div></div><div  class = 'S8'><span>Notice that the table columns above are identical to columns in rpc except for an additional class_pc_flag attribute, which holds the ATL08 photon class values. </span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% disp first five rows and selected columns of the data</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >selcols = [1,3,5:9]; </span><span style="color: rgb(0, 128, 19);">% selected column indices</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >disp(cpc(1:5,selcols))</span></span></div></div></div><div  class = 'S8'><span style=' font-style: italic;'></span></div><div  class = 'S1'><span style=' font-style: italic;'>Retrieving normalized point cloud: </span><span>The xATLy toolbox provides a means of retrieving a classified point cloud normalized to aboveground elevation level, which is useful in estimating vegetation canopy heights. This normalized point cloud can be obtained using two methods:</span></div><ol  class = 'S2'><li  class = 'S3'><span>The </span><span style=' font-family: monospace;'>getnormalizedpc</span><span> method can be applied directly to the ground track object, retrieving the classified point cloud and then normalizing it to aboveground level.</span></li><li  class = 'S3'><span>Alternatively, the normalized point cloud can be obtained from a table object returned by the </span><span style=' font-family: monospace;'>getclassedpc</span><span> method, which applies normalization to the table object.</span></li></ol><div  class = 'S1'><span>If the classified point cloud has already been retrieved, the second method is more efficient. In either case, the resulting table will include an nelevation column defining the aboveground heights.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% first approach</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >npc = gt.getnormalizedpc(); </span><span style="color: rgb(0, 128, 19);">% using default parameter values</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% display table columns</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >disp(string(npc.Properties.VariableNames'))</span></span></div></div></div><div  class = 'S8'><span></span></div><div  class = 'S1'><span></span></div><div  class = 'S1'><span></span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >selcols = [1,3,5:7,9:10]; </span><span style="color: rgb(0, 128, 19);">% selected column indices</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >disp(npc(1:5,selcols)) </span><span style="color: rgb(0, 128, 19);">% some columns intentionally left out due to page limits</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% second approach</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >[grndFunc, ~] = fitgroundmodel(cpc); </span><span style="color: rgb(0, 128, 19);">% fit curve to terrain points to estimate ground level</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >removeptsbelow = true; </span><span style="color: rgb(0, 128, 19);">% remove points below fitted ground level</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >npc = normalizepts(cpc,grndFunc,removeptsbelow); </span><span style="color: rgb(0, 128, 19);">% using default parameter values</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >disp(npc(1:5,selcols))</span></span></div></div></div><div  class = 'S1'><span style=' font-style: italic;'>Reading ATL08 data.</span><span> The ground track object's </span><span style=' font-family: monospace;'>getATL08data</span><span> method allows for reading data from an ATL08 granule. ATL08 data are grouped into two main categories: </span><span style=' font-style: italic;'>'signal_photons'</span><span> and</span><span style=' font-style: italic;'> 'land_segments'</span><span>. The former pertains to parameters related to individual photons, while the latter pertains to segment-level metrics.</span></div><div  class = 'S1'><span>Within the land_segments category, there are two subgroups: </span><span style=' font-style: italic;'>'canopy' </span><span>and </span><span style=' font-style: italic;'>'terrain'</span><span>, which contain metrics related to canopy and terrain heights. The </span><span style=' font-family: monospace;'>getATL08data</span><span> method enables retrieval of segment-level, canopy, and terrain data. By default, the method retrieves longitude, latitude, number of points in segment (</span><span style=' font-style: italic;'>n_seg_ph</span><span>), canopy height (</span><span style=' font-style: italic;'>h_canopy</span><span>), and mean terrain height (h_te_mean). The resulting output also includes the ATL08 </span><span style=' font-style: italic;'>segment_id_beg</span><span> attribute as a unique identifier.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% read ATL08 data using default parameter values</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >attr_tbl = gt.getATL08data();</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >disp(attr_tbl(1:5,:)) </span><span style="color: rgb(0, 128, 19);">% display first 5 rows</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% read ATL08 data by specifying custom list of attributes</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >landseg_atrr = {</span><span style="color: rgb(167, 9, 245);">'longitude'</span><span >,</span><span style="color: rgb(167, 9, 245);">'latitude'</span><span >,</span><span style="color: rgb(167, 9, 245);">'night_flag'</span><span >}; </span><span style="color: rgb(0, 128, 19);">% land_segments attributes</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >ca_attr = {</span><span style="color: rgb(167, 9, 245);">'n_ca_photons'</span><span >,</span><span style="color: rgb(167, 9, 245);">'n_toc_photons'</span><span >,</span><span style="color: rgb(167, 9, 245);">'h_canopy'</span><span >}; </span><span style="color: rgb(0, 128, 19);">% canopy group attributes</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >te_attr = {}; </span><span style="color: rgb(0, 128, 19);">% gets no attributes from terrain group</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >attr_tbl = gt.getATL08data(landseg_atrr,ca_attr,te_attr);</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >disp(attr_tbl(1:5,:)) </span><span style="color: rgb(0, 128, 19);">% display first 5 rows</span></span></div></div></div><div  class = 'S1'><span>To successfully retrieve ATL08 data, one must provide exact attribute names from the ATL08 data dictionary. The xATLy toolbox includes a </span><span style=' font-family: monospace;'>showattr</span><span> method that allows for listing the attributes in a given group. The method displays the attributes in rows, with each row containing 5 attribute names separated by the "|" character. An example of the </span><span style=' font-family: monospace;'>showattr</span><span> method's output is shown below.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% List segment level attributes</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >gt.showattr(</span><span style="color: rgb(167, 9, 245);">'land_seg'</span><span >) </span><span style="color: rgb(0, 128, 19);">% lists segment level attributes</span></span></div></div></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% list canopy related height metrics</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >gt.showattr(</span><span style="color: rgb(167, 9, 245);">'canopy'</span><span >) </span><span style="color: rgb(0, 128, 19);">% lists canopy metrics</span></span></div></div></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% list terrain related height metrics</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >gt.showattr(</span><span style="color: rgb(167, 9, 245);">'terrain'</span><span >) </span><span style="color: rgb(0, 128, 19);">% lists terrain metrics</span></span></div></div></div><h2  class = 'S0' id = 'H_32BFFF48' ><span>Visualizing photon data</span></h2><div  class = 'S1'><span>The </span><span style=' font-family: monospace;'>atdplot </span><span>utility function allows for visualization of ground track point cloud data by plotting the along-track distance against elevation or aboveground height. The function can be called using either the ground track object or the table objects returned by the </span><span style=' font-family: monospace;'>getrawpc</span><span>, </span><span style=' font-family: monospace;'>getclassedpc</span><span>, and </span><span style=' font-family: monospace;'>getnormalizedpc</span><span> methods. It should be noted that plotting directly from the ground track object retrieves data on the fly and may be slower than using pre-retrieved table objects.</span></div><div  class = 'S1'><span>The following example demonstrates the visualization of raw, classified, and normalized point clouds in a tiled layout. All graphs are focused on data stretching from 300 m to 800 m along-track.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >atdlim = [300,800]; </span><span style="color: rgb(0, 128, 19);">% restricts plotting to this atd range</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >figure(</span><span style="color: rgb(167, 9, 245);">'units'</span><span >,</span><span style="color: rgb(167, 9, 245);">'normalized'</span><span >,</span><span style="color: rgb(167, 9, 245);">'outerposition'</span><span >,[0.0 0.0 0.5 1]);</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >tiledlayout(3,1);</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% plot raw point cloud directly from gt object</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >ax0 = nexttile;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >atdplot(gt,</span><span style="color: rgb(167, 9, 245);">'r'</span><span >,[],atdlim) </span><span style="color: rgb(0, 128, 19);">% plot using default colors</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >box </span><span style="color: rgb(167, 9, 245);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >xlim([atdlim(1),atdlim(2)])</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >ylim([1050,1150])</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% plot classified point cloud </span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >ax1 = nexttile;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >atdplot(cpc,</span><span style="color: rgb(167, 9, 245);">'c'</span><span >,[],atdlim)</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >box </span><span style="color: rgb(167, 9, 245);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >xlim([atdlim(1),atdlim(2)])</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >ylim([1050,1150])</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span style="color: rgb(0, 128, 19);">% plot aboveground point cloud</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >ax2 = nexttile;</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >atdplot(npc,</span><span style="color: rgb(167, 9, 245);">'n'</span><span >,[],atdlim)</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >box </span><span style="color: rgb(167, 9, 245);">on</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >xlim([atdlim(1),atdlim(2)])</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >ylim([0,25])</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >linkaxes([ax0,ax1, ax2],</span><span style="color: rgb(167, 9, 245);">'x'</span><span >)</span></span></div></div></div><h3  class = 'S4' id = 'H_1AEFA7CC' ><span>Saving attribute data</span></h3><div  class = 'S1'><span>Attribute data, e.g. raw point clouds, can readily be saved as ASCII text files to facilitate further analyses. The code below saves the </span><span style=' font-style: italic;'>cpc</span><span> table retrieved in the preceding steps to a CSV file using the </span><span style=' font-family: monospace;'>savetable</span><span> function</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >pc_fn = </span><span style="color: rgb(167, 9, 245);">'./temp/gt1l_tbl.csv'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >savetable(cpc,pc_fn) </span><span style="color: rgb(0, 128, 19);">% writes the classified pc</span></span></div></div></div><h3  class = 'S4' id = 'H_7FE258F4' ><span>Writing auxilliary vector data</span></h3><div  class = 'S1'><span>Auxiliary outputs such as KML or Shapefiles representing a reference ground track (rgt) or segment level polygons can be readily generated to support visualization, presentation, or validation assessments. The current implementation only supports saving outputs in WGS84 geographical coordinates.</span></div><div class="CodeBlock"><div class="inlineWrapper"><div  class = 'S5'><span style="white-space: pre"><span >rgt_fn = </span><span style="color: rgb(167, 9, 245);">'./temp/gt1l_rgt.shp'</span><span >; </span><span style="color: rgb(0, 128, 19);">% output filepath</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >gt.writergt(rgt_fn) </span><span style="color: rgb(0, 128, 19);">% writes the rgt as shapefile</span></span></div></div><div class="inlineWrapper"><div  class = 'S6'>&nbsp;</div></div><div class="inlineWrapper"><div  class = 'S6'><span style="white-space: pre"><span >seg_fn = </span><span style="color: rgb(167, 9, 245);">'./temp/gt1l_seg.shp'</span><span >;</span></span></div></div><div class="inlineWrapper"><div  class = 'S7'><span style="white-space: pre"><span >gt.writesegpol(seg_fn) </span><span style="color: rgb(0, 128, 19);">% writes the ATL08 segment polygons as shapefile</span></span></div></div></div><h2  class = 'S0' id = 'H_E967A39A' ><span>Concluding remarks</span></h2><div  class = 'S1'><span>This notebook showcased the utilization of the xATLy toolbox for land and vegetation applications, specifically for reading, visualization, and exporting data from both ATL03 and ATL08 datasets. The majority of the functions utilized in this demonstration were executed with default parameter settings. It is recommended to refer to the documentation of each method to explore further possibilities for utilizing the toolbox to fulfill your specific needs.</span></div>
<br>
<!-- 
##### SOURCE BEGIN #####
%% Introduction to working with the xATLy toolbox
% The xATLy toolkit comprises of various functions and classes that are designed 
% to seamlessly integrate with the MATLABÂ® environments provided by MathWorks. 
% Its main purpose is to simplify the reading, visualization, and manipulation 
% of ICESat-2 ATL03 and ATL08 data in HDF5 format. Ultimately, the goal of the 
% toolkit is to enable the creation of custom terrain and canopy height datasets 
% that align with specific user requirements.
% 
% The xATLy toolkit was created to establish a connection between ATL03 and 
% ATL08 data, with the aim of deriving precise vegetation height estimates. To 
% achieve this, the toolkit has implemented an object-oriented design that consists 
% of three main class objects: Atl03, Atl08, and gtrack.
%% 
% * The Atl03 class is responsible for providing an interface to access the 
% photon level 3D data stored in HDF5 files, making it easier for users to access 
% this information. The Atl08 class, on the other hand, offers access to a diverse 
% range of ATL08 segment level attributes, such as canopy and terrain height metrics 
% and signal photon level classifications, which can be used to generate highly 
% detailed datasets.
% * Finally, the gtrack class is a ground track object that represents one of 
% the six ground tracks present in an ATL03/ATL08 granule. This class plays a 
% crucial role in the process of deriving vegetation height estimates, as it enables 
% users to identify and analyze specific ground tracks that are relevant to their 
% research.
%% 
% To establish a clear relationship between the gtrack object and matching ATL03 
% and ATL08 granule objects, the former has been modeled as a OOP composition. 
% This approach ensures that the gtrack object is tightly bound to its corresponding 
% granule objects, allowing for efficient data manipulation.
% 
% The methods associated with the gtrack object typically produce tabular data 
% formats that include raw, classified, and normalized ATL03 points. In addition 
% to these outputs, the gtrack object also provides auxiliary data such as ATL08 
% segment polygons in shapefile or KML format. This makes it easier for users 
% to visualize and analyze the data, as it can be easily integrated into other 
% tools and software.
% 
% The following sections demonstrates features of the xATLy toolbox including:
%% 
% # Defining Atl03 and Atl08 objects
% # Defining ground track object for data access
% # Exploring and reading data and attributes from defined ground track
% # Displaying raw and classified ATL03 point clouds for a ground track
% # Generating auxiliary Reference ground track (RGT) and ATL08 segment vector 
% data
% # Saving retrieved point cloud data
% # Concluding remarks
% Define Atl03 and Atl08 objects
% Access to ATL03 and ATL08 data is established through respective |Atl03| and 
% |Atl08| objects as illustrated below. Two file paths are provided, one for the 
% ATL03 and other for the matching ATL08 data.

atl03path = 'F:\devs\xATLy\data\ATL03_20190603025340_10050314_002_01.h5'; % ATL03 filepath
atl08path = 'F:\devs\xATLy\data\ATL08_20190603025340_10050314_002_01.h5'; % ATL08 filepath


% creates Atl03 and Atl08 objects
a3 = Atl03(atl03path);
a8 = Atl08(atl08path);
%% 
% Display basic object properties using MATLAB disp function. 

% ATL03 - basic attributes
disp(a3) 
%% 
% For a slightly detailed display of granule properties one can use the |showinfo| 
% method for both the |Atl03| and |Atl08| objects. The ATL03/ and ATL08 products 
% have numerous attributes. The |showinfo| method only outputs a few attributes 
% necessary to provide an adequate overview of dataset as shown below.

a3.showinfo() % detailed attributes/values
% ATL08
disp(a8)
%% 
% 
% 
% 
% 
% 

a8.showinfo()
%% 
% It is important to note that the orbit number (orbitnum) and cycle number 
% (cyclenum) must match between the two objects in order to ensure that both datasets 
% represent identical ground tracks. This is a critical requirement that must 
% be met to avoid any discrepancies in the data.
% 
% As a result of this matching process, the ground tracks (groundtracks) and 
% beam sequence (beamsequence) will also be identical. However, there are instances 
% where some tracks may not be processed in the ATL08 product due to data corruption, 
% resulting in a lack of corresponding ATL08 tracks for some ATL03 tracks.
% 
% The spacecraft is responsible for determining the sequence of strong and weak 
% beams, with strong beams leading weak beams in each pair. In this particular 
% case, the spacecraft orientation is backward (sc_orient = 0).
% Define a gtrack object
% In the xATLy toolbox, calculations are performed at ground track level. As 
% noted already, a gtrack object has a relationship to matching Atl03 and Atl08 
% objects to build synergy between the two products for vegetation applications. 
% The code below initializes a gtrack object for the 'gt1l' track, which is a 
% strong beam as shown by the beamlevel attribute below. 

gt = gtrack('gt1l',a3,a8);
disp(gt)
%% 
% From the output, you can see that this ground track object has atl03 and atl08 
% properties, which establishes the relationship. With the arrangement, one can 
% access ATL03 related attributes through the atl03 object. Likewise, one can 
% access ATL08 attributes through the atl08 object. This facility is demonstrated 
% in the next section.
% Accessing ground track photon or segment level data
% _Reading raw point cloud data._ After creating a ground track object, it is 
% possible to read raw ATL03 point cloud data by utilizing the getrawpc method, 
% as demonstrated below. This method returns a table object that contains geolocation, 
% elevation, and signal confidence attributes. Additionally, the table includes 
% estimated along-track distances, which can be used for plotting and distance-based 
% analyses. The along-track distance is calculated by scaling delta times values 
% by a factor of 1 second equals 7000 meters. The table also includes a signal 
% confidence attribute related to land/vegetation surfaces. Please refer to the 
% <https://nsidc.org/sites/default/files/icesat2_atl03_atbd_r005_0.pdf ATL03 ATBD> 
% for definitions for the other attributes in the table. 

format('bank') % for presentation purposes only - values formatted with 2 decimal places
rpc = gt.getrawpc(); % gets the raw point cloud
% display table columns
disp(string(rpc.Properties.VariableNames)')
% disp first five rows and first seven columns of the data - signal_conf
% not dispalyed due to page limitations. You may display the whole table
% using disp(rpc(1:5,:)) 
disp(rpc(1:5,1:7)) 

%% 
% _Retrieving classified ATL03 point clouds._ The xATLy toolbox facilitates 
% linking of ATL08 signal photon classifications, under the signal_photons group, 
% with raw ATL03 point clouds to derive a classified point cloud through the |getclassedpc| 
% method. 

cpc = gt.getclassedpc(); % get classed point cloud
% display table columns
disp(string(cpc.Properties.VariableNames)')
%% 
% Notice that the table columns above are identical to columns in rpc except 
% for an additional class_pc_flag attribute, which holds the ATL08 photon class 
% values. 

% disp first five rows and selected columns of the data
selcols = [1,3,5:9]; % selected column indices
disp(cpc(1:5,selcols))
%% 
% 
% 
% _Retrieving normalized point cloud:_ The xATLy toolbox provides a means of 
% retrieving a classified point cloud normalized to aboveground elevation level, 
% which is useful in estimating vegetation canopy heights. This normalized point 
% cloud can be obtained using two methods:
%% 
% # The |getnormalizedpc| method can be applied directly to the ground track 
% object, retrieving the classified point cloud and then normalizing it to aboveground 
% level.
% # Alternatively, the normalized point cloud can be obtained from a table object 
% returned by the |getclassedpc| method, which applies normalization to the table 
% object.
%% 
% If the classified point cloud has already been retrieved, the second method 
% is more efficient. In either case, the resulting table will include an nelevation 
% column defining the aboveground heights.

% first approach
npc = gt.getnormalizedpc(); % using default parameter values

% display table columns
disp(string(npc.Properties.VariableNames'))
%% 
% 
% 
% 
% 
% 

selcols = [1,3,5:7,9:10]; % selected column indices
disp(npc(1:5,selcols)) % some columns intentionally left out due to page limits
% second approach
[grndFunc, ~] = fitgroundmodel(cpc); % fit curve to terrain points to estimate ground level
removeptsbelow = true; % remove points below fitted ground level
npc = normalizepts(cpc,grndFunc,removeptsbelow); % using default parameter values
disp(npc(1:5,selcols))
%% 
% _Reading ATL08 data._ The ground track object's |getATL08data| method allows 
% for reading data from an ATL08 granule. ATL08 data are grouped into two main 
% categories: _'signal_photons'_ and _'land_segments'_. The former pertains to 
% parameters related to individual photons, while the latter pertains to segment-level 
% metrics.
% 
% Within the land_segments category, there are two subgroups: _'canopy'_ and 
% _'terrain'_, which contain metrics related to canopy and terrain heights. The 
% |getATL08data| method enables retrieval of segment-level, canopy, and terrain 
% data. By default, the method retrieves longitude, latitude, number of points 
% in segment (_n_seg_ph_), canopy height (_h_canopy_), and mean terrain height 
% (h_te_mean). The resulting output also includes the ATL08 _segment_id_beg_ attribute 
% as a unique identifier.

% read ATL08 data using default parameter values
attr_tbl = gt.getATL08data();
disp(attr_tbl(1:5,:)) % display first 5 rows
% read ATL08 data by specifying custom list of attributes
landseg_atrr = {'longitude','latitude','night_flag'}; % land_segments attributes
ca_attr = {'n_ca_photons','n_toc_photons','h_canopy'}; % canopy group attributes
te_attr = {}; % gets no attributes from terrain group
attr_tbl = gt.getATL08data(landseg_atrr,ca_attr,te_attr);
disp(attr_tbl(1:5,:)) % display first 5 rows
%% 
% To successfully retrieve ATL08 data, one must provide exact attribute names 
% from the ATL08 data dictionary. The xATLy toolbox includes a |showattr| method 
% that allows for listing the attributes in a given group. The method displays 
% the attributes in rows, with each row containing 5 attribute names separated 
% by the "|" character. An example of the |showattr| method's output is shown 
% below.

% List segment level attributes
gt.showattr('land_seg') % lists segment level attributes
%%
% list canopy related height metrics
gt.showattr('canopy') % lists canopy metrics
%%
% list terrain related height metrics
gt.showattr('terrain') % lists terrain metrics
%% Visualizing photon data
% The |atdplot| utility function allows for visualization of ground track point 
% cloud data by plotting the along-track distance against elevation or aboveground 
% height. The function can be called using either the ground track object or the 
% table objects returned by the |getrawpc|, |getclassedpc|, and |getnormalizedpc| 
% methods. It should be noted that plotting directly from the ground track object 
% retrieves data on the fly and may be slower than using pre-retrieved table objects.
% 
% The following example demonstrates the visualization of raw, classified, and 
% normalized point clouds in a tiled layout. All graphs are focused on data stretching 
% from 300 m to 800 m along-track.

atdlim = [300,800]; % restricts plotting to this atd range

figure('units','normalized','outerposition',[0.0 0.0 0.5 1]);
tiledlayout(3,1);

% plot raw point cloud directly from gt object
ax0 = nexttile;
atdplot(gt,'r',[],atdlim) % plot using default colors
box on
xlim([atdlim(1),atdlim(2)])
ylim([1050,1150])

% plot classified point cloud 
ax1 = nexttile;
atdplot(cpc,'c',[],atdlim)
box on
xlim([atdlim(1),atdlim(2)])
ylim([1050,1150])

% plot aboveground point cloud
ax2 = nexttile;
atdplot(npc,'n',[],atdlim)
box on
xlim([atdlim(1),atdlim(2)])
ylim([0,25])
linkaxes([ax0,ax1, ax2],'x')
% Saving attribute data
% Attribute data, e.g. raw point clouds, can readily be saved as ASCII text 
% files to facilitate further analyses. The code below saves the _cpc_ table retrieved 
% in the preceding steps to a CSV file using the |savetable| function

pc_fn = './temp/gt1l_tbl.csv';
savetable(cpc,pc_fn) % writes the classified pc
% Writing auxilliary vector data
% Auxiliary outputs such as KML or Shapefiles representing a reference ground 
% track (rgt) or segment level polygons can be readily generated to support visualization, 
% presentation, or validation assessments. The current implementation only supports 
% saving outputs in WGS84 geographical coordinates.

rgt_fn = './temp/gt1l_rgt.shp'; % output filepath
gt.writergt(rgt_fn) % writes the rgt as shapefile

seg_fn = './temp/gt1l_seg.shp';
gt.writesegpol(seg_fn) % writes the ATL08 segment polygons as shapefile
%% Concluding remarks
% This notebook showcased the utilization of the xATLy toolbox for land and 
% vegetation applications, specifically for reading, visualization, and exporting 
% data from both ATL03 and ATL08 datasets. The majority of the functions utilized 
% in this demonstration were executed with default parameter settings. It is recommended 
% to refer to the documentation of each method to explore further possibilities 
% for utilizing the toolbox to fulfill your specific needs.
##### SOURCE END #####
-->
</div></body></html>